import os
from fastmcp import FastMCP

{{ pixie_sdk_import }}

{% if mcp_config %}
mcp_config = {{ mcp_config_json|safe }}
mcp = FastMCP.as_proxy(mcp_config, name="{{ server_name }}")
{% else %}
mcp = FastMCP(name="{{ server_name }}")
{% endif %}

{% if tool_functions %}
{% for tool_func in tool_functions %}
{{ tool_func }}
{% endfor %}
{% endif %}

{% if resources %}
{% for resource_func in resources %}
{{ resource_func }}
{% endfor %}
{% endif %}

app = mcp.http_app()

if __name__ == "__main__":
    import os
    host = os.getenv("HOST", "0.0.0.0")
    port = int(os.getenv("PORT", 8000))
    
    mcp.settings.port = port
    mcp.settings.host = host
    
    print(f"ðŸš€ Starting MCP server on HTTP (streamable-http transport)")
    print(f"ðŸ“¡ Server will use streamable-http transport settings")
    print(f"   Host: {host}")
    print(f"   Port: {port}")
    print(f"   Endpoint: http://{host}:{port}/")
    
    mcp.run(transport="streamable-http")
